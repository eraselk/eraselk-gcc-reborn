#!/usr/bin/env bash

echo "*****************************************"
echo "*        Download GCC & Binutils        *"
echo "*****************************************"

export IS_MASTER="${1}"

download() {
    git clone -b binutils-2_42 --depth=1 git://sourceware.org/git/binutils-gdb.git binutils
    sudo apt update -y && sudo apt upgrade -y && sudo apt install -y openssl openssh wget tar
    
    wget https://ftp.gnu.org/gnu/gcc/gcc-11.1.0/gcc-11.1.0.tar.gz -O gcc-tarball
    tar -xf gcc-tarball
    rm -f gcc-tarball
    mv -f gcc* gcc
    git clone -b v1.5.5 https://github.com/facebook/zstd zstd
  fi
  sed -i '/^development=/s/true/false/' binutils/bfd/development.sh
  cd gcc
  ./contrib/download_prerequisites
  cd ../binutils
  git apply -3 ../patch/compilespeed-binutils.patch || true
  cd ..
}

download
